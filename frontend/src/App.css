
/* ========================= THEME & RESET ========================= */
:root {
  --bg-root: #14181d;
  --bg-panel: #181d23;
  --bg-panel-alt: #202831;
  --grad-accent: linear-gradient(90deg,#52a9ff,#46f2c2);
  --accent: #52c2ff;
  --accent-alt: #46f2c2;
  --danger: #ff5f56;
  --warn: #ffb347;
  --ok: #46d982;
  --radius-sm: 6px;
  --radius: 12px;
  --radius-lg: 24px;
  --shadow-soft: 0 4px 18px -4px rgba(0,0,0,.4), 0 2px 4px -1px rgba(0,0,0,.35);
  --shadow-raised: 0 6px 26px -6px rgba(0,0,0,.55), 0 4px 10px -2px rgba(0,0,0,.4);
  --trans-fast: .15s cubic-bezier(.4,.2,.2,1);
  /* editor additional tokens */
  --panel-bg: var(--bg-panel);
  --panel-lighter: #1f262d;
  --panel-border: #2a333b;
  --accent1: var(--accent);
  --accent2: var(--accent-alt);
  --accent-faint: #2b3944;
  --text: #e4eef5;
  --text-dim: #9dabb5;
}
body {
  margin: 0;
  background: radial-gradient(circle at 30% 20%, #1f2a33 0%, #14181d 55%) fixed;
  min-height: 100vh;
  -webkit-font-smoothing: antialiased;
  text-rendering: optimizeLegibility;
  font-family: 'Montserrat','Arial',sans-serif;
  overscroll-behavior: none;
}

.container {
  max-width: 460px;
  margin: 0 auto;
  background: linear-gradient(145deg,var(--bg-panel) 0%, var(--bg-panel-alt) 100%);
  color: #f5f9ff;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-soft);
  padding: env(safe-area-inset-top) 12px calc(env(safe-area-inset-bottom) + 70px) 12px;
  position: relative;
  min-height: 100vh;
  box-sizing: border-box;
  backdrop-filter: blur(4px) saturate(1.2);
  display:flex;
  flex-direction:column;
}
.header {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 8px 4px 6px 4px;
  position: sticky;
  top: 0;
  background: linear-gradient(145deg,var(--bg-panel) 0%, #14181d 140%);
  z-index: 40;
  border-radius: 0 0 var(--radius) var(--radius);
  backdrop-filter: blur(6px) brightness(.95);
}
.avatar {
  width: 52px;
  height: 52px;
  border-radius: 50%;
  background: linear-gradient(135deg,#2f3942,#20272e);
  box-shadow: 0 4px 14px -4px #000c, 0 0 0 2px #1e252b;
  object-fit: cover;
}
.nickname {
  font-size: 1.3em;
  font-weight: bold;
  letter-spacing: 1px;
}
.level-bar {
  flex: 1;
  height: 16px;
  background: #2a3139;
  border-radius: 8px;
  margin-left: 12px;
  position: relative;
  overflow: hidden;
  box-shadow: inset 0 0 0 1px #36414b, 0 2px 4px -1px #000a;
  font-size: 10px;
  line-height: 1;
}
.level-fill {
  height: 100%;
  background: var(--grad-accent);
  border-radius: 8px;
  transition: width .35s cubic-bezier(.4,.2,.2,1);
  box-shadow: 0 0 6px 2px #46f2c244, 0 0 0 1px #46f2c233;
}
.level-overlay {
  position:absolute;
  inset:0;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 6px;
  color:#d9f7ff;
  font-weight:600;
  text-shadow:0 1px 2px #000c;
  pointer-events:none;
  letter-spacing:.5px;
}
.level-overlay span { opacity:.9; }
/* (стили переработанного главного экрана удалены по revert) */
.main { position:relative; }
.main-stage { flex:1 1 auto; margin-top:8px; margin-bottom:8px; border-radius: var(--radius-lg); position:relative; overflow:hidden; display:flex; align-items:flex-end; justify-content:center; }
.main-stage { --skyX:0px; --groundX:0px; }
.stage-bg-main { position:absolute; inset:0; background:
  linear-gradient(180deg,#2f3f4b 0%, #1c262d 70%),
  repeating-linear-gradient(90deg, rgba(255,255,255,0.05) 0 120px, rgba(255,255,255,0.02) 120px 240px);
  background-blend-mode: overlay; animation: skyPulse 12s ease-in-out infinite; }
.stage-bg-main:after { content:''; position:absolute; inset:0; background: radial-gradient(circle at 60% 28%, rgba(160,210,255,0.22), transparent 60%); background-position-x: var(--skyX,0px); }
@keyframes groundScroll { from { background-position-x:0; } to { background-position-x:-360px; } }
@keyframes groundOverlayScroll { from { background-position-x:0; } to { background-position-x:-360px; } }
@keyframes skyScroll { from { background-position-x:0; } to { background-position-x:-360px; } }
.stage-ground-main { position:absolute; left:0; right:0; bottom:0; height:72px; background:
  repeating-linear-gradient(90deg,#2c3942 0 40px,#253038 40px 80px),
  linear-gradient(180deg,#32464f,#1a2328); box-shadow:0 -2px 10px -4px #000 inset; border-top:1px solid #3a4952; overflow:hidden;
  animation: groundScroll 3.6s linear infinite;
  animation-play-state: paused;
}
.stage-ground-main:before { content:''; position:absolute; inset:0; background:
  repeating-linear-gradient(90deg,#3a4d56 0 18px,#2b3b43 18px 36px); opacity:.35; mix-blend-mode:overlay;
  animation: groundOverlayScroll 3.6s linear infinite; animation-play-state: paused;
}
.main-stage.travel .stage-ground-main,
.main-stage.travel .stage-ground-main:before { animation-play-state: running; }
.main-stage.travel.fight .stage-ground-main,
.main-stage.travel.fight .stage-ground-main:before { animation-play-state: paused; }
.stage-bg-main:after { animation: skyScroll 12s linear infinite; animation-play-state: paused; }
.main-stage.travel .stage-bg-main:after { animation-play-state: running; }
.stage-player { bottom:70px !important; transition: transform .25s; }
@keyframes skyPulse { 0%,100% { filter:brightness(1); } 50% { filter:brightness(1.08); } }
.footer {
  position: fixed;
  left: 0; right: 0; bottom: 0;
  display: flex;
  justify-content: space-between;
  gap: 10px;
  padding: 10px 14px calc(env(safe-area-inset-bottom) + 10px);
  background: linear-gradient(180deg, rgba(18,22,27,.3) 0%, rgba(14,16,19,.9) 60%);
  backdrop-filter: blur(16px) saturate(1.3);
  box-shadow: 0 -2px 12px -2px rgba(0,0,0,.5);
  z-index: 50;
}
.footer button {
  flex: 1;
  margin: 0;
  padding: 14px 0 12px;
  background: linear-gradient(145deg,#2a333c,#20262c);
  color: #dfe9ef;
  border: 1px solid #35404a;
  border-radius: var(--radius);
  font-size: .95rem;
  font-weight: 600;
  letter-spacing: .5px;
  cursor: pointer;
  box-shadow: 0 2px 10px -2px #0008, inset 0 0 0 1px #303a42;
  transition: background var(--trans-fast), transform var(--trans-fast), color var(--trans-fast), box-shadow var(--trans-fast);
  position: relative;
  overflow: hidden;
}
.footer button:before {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(90deg,rgba(255,255,255,.06),rgba(255,255,255,0));
  opacity: 0; pointer-events: none;
  transition: opacity .4s;
}
.footer button:hover:before { opacity: 1; }
.footer button:active {
  transform: translateY(2px) scale(.97);
  background: var(--grad-accent);
  color: #101315;
  box-shadow: 0 1px 4px -1px #0008, 0 0 0 1px #46f2c255;
}

/* Универсальный стиль кнопок (reuse footer style) */
.btn, .modal button, .inv-item button {
  background: linear-gradient(145deg,#2a333c,#20262c);
  color: #dfe9ef;
  border: 1px solid #35404a;
  border-radius: var(--radius-sm);
  font-weight:600;
  letter-spacing:.4px;
  cursor:pointer;
  position:relative;
  overflow:hidden;
  box-shadow: 0 2px 10px -2px #0008, inset 0 0 0 1px #303a42;
  transition: background var(--trans-fast), transform var(--trans-fast), color var(--trans-fast), box-shadow var(--trans-fast);
}
.btn:before, .modal button:before, .inv-item button:before { content:''; position:absolute; inset:0; background:linear-gradient(90deg,rgba(255,255,255,.06),rgba(255,255,255,0)); opacity:0; transition:opacity .4s; }
.btn:hover:before, .modal button:hover:before, .inv-item button:hover:before { opacity:1; }
.btn:active, .modal button:active, .inv-item button:active { transform:translateY(2px) scale(.97); background: var(--grad-accent); color:#101315; box-shadow:0 1px 4px -1px #0008, 0 0 0 1px #46f2c255; }
.btn-danger { background:linear-gradient(145deg,#3d1f23,#2a1013); border-color:#5b272d; color:#ffb8b1; }
.btn-danger:active { background:linear-gradient(145deg,#ff5f56,#ffb347); color:#181b1e; }
.btn-outline { background:#1e252b; border-color:#32414b; box-shadow:0 2px 8px -2px #0008, inset 0 0 0 1px #2a353d; }
.btn-outline:hover { background:#273038; }
.btn-small { padding:6px 10px 7px; font-size:12px; }
.btn-wide { width:100%; }

/* Перекрываем прежний стиль инвентарных кнопок */
.inv-item button { padding:6px 10px 7px; font-size:11px; background:linear-gradient(145deg,#2a333c,#20262c); border-radius:var(--radius-sm); }
.inv-item button:hover { background:#33404a; }
.inv-item button:active { background:var(--grad-accent); color:#101315; }
.screen {
  margin-top: 18px;
  min-height: 48px;
  text-align: center;
  font-size: 1.1em;
}
.adventure-container {
  width: 100%;
  height: 320px;
  border-radius: var(--radius-lg);
  background: linear-gradient(180deg, #232f3a 0%, #161b20 100%);
  box-shadow: 0 4px 20px -4px #000c, 0 2px 8px -2px #0009;
  overflow: hidden;
  position: relative;
  border: 1px solid #283138;
}
.adventure-bg {
  background: repeating-linear-gradient(90deg, #444 0 40px, #333 40px 80px);
  opacity: 0.8;
}
/* Инвентарь */
.inventory-wrapper {
  padding: 8px 2px 4px 2px;
  animation: fadeIn 0.25s;
  background: linear-gradient(145deg,#1a2128,#1d252d);
  border: 1px solid #232d35;
  border-radius: var(--radius);
  box-shadow: var(--shadow-soft);
}

/* Новый экран инвентаря (как главная сцена) */
.inventory-stage { align-items:center; justify-content:center; flex-direction:column; }
.inv-center-strip { position:relative; display:flex; gap:14px; padding:18px 18px 26px; overflow-x:auto; overflow-y:hidden; max-width:100%; scroll-snap-type:x mandatory; }
.inv-center-strip::-webkit-scrollbar { height:10px; }
.inv-center-strip::-webkit-scrollbar-thumb { background:#2a333b; border-radius:6px; }
.inv-center-strip .inv-item.big { min-width:140px; scroll-snap-align:center; }
.footer.single { justify-content:center; }
.footer.single button { min-width:180px; }

/* 3-колоночная сетка экрана инвентаря */
.inv-grid-3 { display:grid; grid-template-columns:repeat(3, minmax(0, 1fr)); gap:18px; width:100%; max-width:760px; margin:0 auto; padding:26px 20px 36px; justify-items:stretch; align-content:start; overflow-y:auto; }
.inv-grid-3 .inv-item.big { min-width:0; }
/* Увеличенный формат ячеек */
.inv-grid-3 .inv-item.big { padding:14px 14px 18px; gap:10px; min-height:170px; }
.inv-grid-3 .inv-item.big .inv-icon { width:64px; height:64px; border-radius:16px; }
.inv-grid-3 .inv-item.big .inv-name { font-size:15px; }
.inv-grid-3 .inv-item.big .inv-bonus { font-size:13px; }
.inv-grid-3 .inv-item.big button { font-size:13px; padding:8px 14px 9px; }
/* Дополнительная адаптация для узких экранов и длинных названий */
.inv-grid-3 { box-sizing:border-box; overscroll-behavior:contain; }
.inv-grid-3 .inv-item.big { display:flex; flex-direction:column; align-items:center; text-align:center; }
.inv-grid-3 .inv-item.big .inv-name { 
  max-width:100%;
  line-height:1.15;
  font-weight:600;
  overflow:hidden;
  display:-webkit-box;
  -webkit-line-clamp:3; /* максимум 3 строки */
  line-clamp:3;
  -webkit-box-orient:vertical;
  word-break:break-word;
  text-overflow:ellipsis;
}
.inv-grid-3 .inv-item.big .inv-bonus { line-height:1.1; }
.inv-grid-3 .inv-item.big button { width:100%; max-width:100%; }
@media (max-width:760px){
  .inv-grid-3 { max-width:680px; }
}
@media (max-width:640px){
  .inv-grid-3 { grid-template-columns:repeat(2,minmax(0,1fr)); gap:16px; padding:22px 18px 32px; }
}
@media (max-width:560px){
  .inv-grid-3 { gap:14px; padding:20px 14px 30px; }
  .inv-grid-3 .inv-item.big { padding:12px 10px 16px; min-height:156px; }
  .inv-grid-3 .inv-item.big .inv-icon { width:58px; height:58px; }
  .inv-grid-3 .inv-item.big .inv-name { font-size:14px; }
  .inv-grid-3 .inv-item.big .inv-bonus { font-size:12px; }
  .inv-grid-3 .inv-item.big button { font-size:12px; }
}
@media (max-width:420px){
  .inv-grid-3 { gap:12px; padding:18px 10px 26px; }
  .inv-grid-3 .inv-item.big { padding:11px 8px 14px; min-height:148px; }
  .inv-grid-3 .inv-item.big .inv-icon { width:54px; height:54px; }
  .inv-grid-3 .inv-item.big .inv-name { font-size:13px; }
}
.inventory-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(96px, 1fr));
  gap: 10px;
  margin-top: 4px;
}
.inv-item {
  background: linear-gradient(145deg,#242d34,#1c2329);
  border: 2px solid #323c46;
  border-radius: var(--radius);
  padding: 6px 6px 9px 6px;
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 4px;
  font-size: 12px;
  box-shadow: 0 3px 10px -2px #0009, inset 0 0 0 1px #20282f;
  position: relative;
  overflow: hidden;
  transition: transform .18s, border-color .25s, box-shadow .25s;
}
.inv-item:hover { transform: translateY(-4px); }
.inv-item.equipped {
  box-shadow: 0 0 0 2px #46f2c2, 0 0 12px 2px #46f2c255, 0 3px 14px -4px #000;
  border-color: #46f2c2dd;
}
.rarity-common { --rarity-color: #bbb; }
.rarity-uncommon { --rarity-color: #6cf; }
.rarity-rare { --rarity-color: #fa6; }
.inv-item.rarity-common { border-color: #777; }
.inv-item.rarity-uncommon { border-color: #35b5ff; box-shadow: 0 0 0 2px #35b5ff33, 0 0 10px #35b5ff44; }
.inv-item.rarity-rare { border-color: #ffb366; box-shadow: 0 0 0 2px #ffb36633, 0 0 10px #ffb36655; }
.inv-item.new-drop { animation: popIn .6s ease; }

@keyframes popIn { 0% { transform: scale(.4) rotate(-10deg); opacity:0; } 60% { transform: scale(1.05); opacity:1; } 100% { transform: scale(1); } }

.event-log { margin-top: 8px; max-height: 90px; overflow-y: auto; font-size: 11px; text-align: left; padding-right:4px; }
.event-log::-webkit-scrollbar { width: 6px; }
.event-log::-webkit-scrollbar-track { background: #222; }
.event-log::-webkit-scrollbar-thumb { background: #444; border-radius: 3px; }
.inv-icon {
  width: 36px;
  height: 36px;
  background: linear-gradient(135deg,#56626d,#313a42);
  border-radius: 10px;
  box-shadow: inset 0 2px 4px #0009, 0 0 0 1px #2d353b;
  position: relative;
}
.inv-icon.type-weapon::before,
.inv-icon.type-shield::before {
  content:''; position:absolute; inset:0; display:block;
  background: none;
}
.inv-icon.type-weapon::before {
  width: 60%; height:4px; background:#e35555; position:absolute; top:50%; left:20%; transform:translateY(-50%) rotate(-35deg); border-radius:2px; box-shadow:0 0 4px -1px #f66;
}
.inv-icon.type-weapon::after {
  content:''; position:absolute; width:22%; height:8px; background:#cfcfcf; left:38%; top:50%; transform:translateY(-50%) rotate(-35deg); border-radius:2px; box-shadow:0 0 2px #000a inset;
}
.inv-icon.type-shield::before {
  content:''; position:absolute; width:56%; height:56%; left:22%; top:22%; background:radial-gradient(circle at 30% 30%,#ccd,#99a), linear-gradient(145deg,#8ea2b0,#50606c); border-radius:18% 18% 40% 40%; box-shadow:0 0 0 1px #1f262c, 0 2px 4px -1px #000a inset;
}
.inv-icon:after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(45deg,rgba(255,255,255,.18),rgba(255,255,255,0));
  mix-blend-mode: overlay;
  border-radius: inherit;
}
.inv-name { font-weight: 600; }
.inv-bonus { font-size: 11px; opacity: 0.9; }
.inv-item button {
  background: #2b3239;
  color: #e6eef2;
  border: 1px solid #3a4651;
  padding: 4px 10px 5px;
  border-radius: var(--radius-sm);
  font-size: 11px;
  cursor: pointer;
  transition: background var(--trans-fast), color var(--trans-fast), transform var(--trans-fast), box-shadow var(--trans-fast);
  box-shadow: 0 2px 6px -2px #0008, inset 0 0 0 1px #2d363d;
}
.inv-item button:hover { background: #36414b; }
.inv-item button:active { background: var(--grad-accent); color:#0e1215; transform: translateY(2px); box-shadow: 0 1px 4px -1px #000a; }

@keyframes fadeIn { from { opacity: 0; transform: translateY(8px);} to { opacity:1; transform: translateY(0);} }
@media (max-width: 600px) {
  .container { max-width: 100vw; border-radius: 0; box-shadow: none; padding: env(safe-area-inset-top) 8px calc(env(safe-area-inset-bottom) + 70px) 8px; }
  .main { height: 120px; }
  .adventure-container { height: 240px; border-radius: 18px; }
  .footer button { font-size: .85rem; padding: 12px 0 10px; }
  .avatar { width: 46px; height: 46px; }
  .inventory-grid { grid-template-columns: repeat(auto-fill, minmax(88px,1fr)); gap: 8px; }
  .inv-icon { width: 34px; height: 34px; }
}

@media (max-width: 380px) {
  .footer { gap: 6px; padding: 8px 10px calc(env(safe-area-inset-bottom) + 8px); }
  .footer button { font-size: .78rem; letter-spacing: .3px; }
  .nickname { font-size: 1.05em; }
}

/* ================= Character Editor (adaptive themed) ================= */
.editor-root {
  display:flex;
  flex-direction:column;
  gap:14px;
  background: linear-gradient(145deg,var(--bg-panel) 0%, var(--bg-panel-alt) 120%);
  padding:18px 18px 30px;
  border-radius: var(--radius-lg);
  box-shadow: var(--shadow-soft), 0 0 0 1px rgba(255,255,255,0.04) inset;
  color: var(--text);
  position: relative;
  overflow:hidden; /* вертикальные хвосты скрываем */
  box-sizing:border-box;
  width:100%;
  max-width:100%;
  align-items:center; /* центрируем внутренние секции */
}
.editor-canvas-col, .editor-canvas-wrap, .canvas-scale-holder, .canvas-scale-inner { max-width:100%; }
/* Единая центральная колонка: ограничиваем ширину всех основных блоков */
/* Централизуем контент редактора в границах основного контейнера приложения */
.editor-root > .editor-toolbar,
.editor-root > .editor-frames,
.editor-root > .editor-zoom,
.editor-root > .editor-canvas-col,
.editor-root > .editor-hint,
.editor-root > .editor-drawing,
.editor-root > .editor-attachments,
.editor-root > .editor-tip,
.editor-root > .editor-save-row {
  width:100%;
  max-width:460px; /* совпадает с .container */
  margin-left:auto;
  margin-right:auto;
  box-sizing:border-box;
  padding-left:4px;
  padding-right:4px;
}
/* Внутри колонны тоже растягиваем инвентарь и холст равномерно */
.editor-canvas-col { width:100%; }
.inv-hstrip-wrapper { width:100%; }
/* Лёгкое затухание по бокам если содержимое шире (предотвращает визуальный обрез) */
.editor-canvas-wrap::after, .inv-hstrip-wrapper::after {
  content:''; pointer-events:none; position:absolute; top:0; bottom:0; right:0; width:20px;
  background:linear-gradient(90deg,rgba(0,0,0,0),rgba(0,0,0,0.35));
}
.editor-canvas-wrap::before, .inv-hstrip-wrapper::before {
  content:''; pointer-events:none; position:absolute; top:0; bottom:0; left:0; width:20px;
  background:linear-gradient(270deg,rgba(0,0,0,0),rgba(0,0,0,0.35));
}
@media (max-width:520px){
  .editor-root > .editor-toolbar,
  .editor-root > .editor-frames,
  .editor-root > .editor-zoom,
  .editor-root > .editor-canvas-col,
  .editor-root > .editor-hint,
  .editor-root > .editor-drawing,
  .editor-root > .editor-attachments,
  .editor-root > .editor-tip,
  .editor-root > .editor-save-row { max-width:100%; padding-left:2px; padding-right:2px; }
}
/* Защита от внезапного горизонтального скролла на очень узких экранах */
@media (max-width:600px) {
  .editor-root { padding-left:12px; padding-right:12px; }
  .editor-canvas-wrap { padding:8px; }
}
.editor-left { flex:1 1 340px; min-width:280px; }
.editor-side { width:300px; max-width:100%; position:sticky; top:8px; align-self:flex-start; }

.editor-toolbar { display:flex; flex-wrap:wrap; gap:10px; margin-bottom:8px; }
.editor-mode { display:flex; gap:6px; }
.editor-actions { display:flex; gap:6px; }

.ed-btn { background: var(--panel-bg); color: var(--text-dim); border:1px solid var(--panel-border); padding:6px 12px; font-size:13px; border-radius:10px; cursor:pointer; transition:.2s; font-weight:500; letter-spacing:.3px; }
.ed-btn:hover { background: var(--panel-lighter); color: var(--text); }

.xp-float {
  animation: xpPop 1.1s ease-out forwards;
  pointer-events: none;
  filter: drop-shadow(0 0 4px #39c);
}
@keyframes xpPop {
  0% { opacity: 0; transform: translate(-50%, -90%) scale(.6) rotate(-6deg); }
  10% { opacity: 1; transform: translate(-50%, -100%) scale(1) rotate(0deg); }
  60% { opacity: 1; transform: translate(-50%, -140%) scale(1.05); }
  100% { opacity: 0; transform: translate(-50%, -190%) scale(.85) rotate(4deg); }
}

.found-exclaim {
  animation: foundPing 900ms ease-out forwards;
  pointer-events:none;
}
@keyframes foundPing {
  0% { opacity:0; transform: translate(-50%, -120%) scale(.2) rotate(-20deg); }
  25% { opacity:1; transform: translate(-50%, -125%) scale(1.05) rotate(3deg); }
  55% { opacity:1; transform: translate(-50%, -140%) scale(1); }
  100% { opacity:0; transform: translate(-50%, -170%) scale(.6) rotate(14deg); }
}

/* Всплывающий справа моб (предстоит бой) */
.mob-upcoming { position:absolute; bottom:70px; transform:translate(-50%,0); z-index:2; pointer-events:none; }
.mob-upcoming.non-embedded { bottom:auto; transform:translate(-50%,-50%); }
.mob-upcoming-icon {
  width:42px; height:42px; border-radius:10px;
  background: var(--mobColor,#666);
  box-shadow:0 0 6px #0008, 0 0 0 0 rgba(255,255,255,0.2) inset;
  animation: mobPulse 1.8s ease-in-out infinite;
}
.mob-danger-exclaim {
  position:absolute;
  left:50%; top:-6px;
  transform:translate(-50%,-100%);
  font-size:26px; font-weight:700;
  color:#ffdc5a;
  text-shadow:0 0 6px #000, 0 0 12px #000c;
  animation: dangerShake 900ms ease-out forwards;
}
@keyframes dangerShake {
  0% { opacity:0; transform:translate(-50%,-90%) scale(.4) rotate(-20deg); }
  18% { opacity:1; transform:translate(-50%,-105%) scale(1.08) rotate(6deg); }
  38% { transform:translate(-50%,-125%) scale(1) rotate(-4deg); }
  55% { transform:translate(-50%,-120%) scale(1) rotate(2deg); }
  70% { transform:translate(-50%,-122%) scale(.96) rotate(-2deg); }
  100% { opacity:0; transform:translate(-50%,-150%) scale(.7) rotate(8deg); }
}
/* Старый pop-in оставим для возможного переиспользования */
.mob-upcoming:not(.slide) { animation: mobPopIn 700ms ease-out forwards; opacity:0; }
@keyframes mobPopIn {
  0% { opacity:0; transform:translate(-40%,0) scale(.4) rotate(-12deg); filter:blur(4px) grayscale(90%); }
  35% { opacity:.9; transform:translate(-55%,0) scale(1.08) rotate(3deg); filter:blur(1px) grayscale(30%); }
  60% { opacity:1; transform:translate(-50%,0) scale(0.98) rotate(-2deg); filter:blur(0) grayscale(10%); }
  100% { opacity:1; transform:translate(-50%,0) scale(1) rotate(0deg); filter:blur(0) grayscale(0%); }
}
@keyframes mobPulse {
  0%,100% { box-shadow:0 0 6px #0008, 0 0 0 0 rgba(255,255,255,0.15) inset; }
  50% { box-shadow:0 0 8px #000c, 0 0 0 6px rgba(255,255,255,0); }
}
.ed-btn.active { background: var(--accent2); color:#081014; border-color: var(--accent2); box-shadow:0 0 0 1px var(--accent2) inset, 0 2px 8px -2px rgba(0,0,0,0.5); }
.ed-btn.primary { background: var(--accent1); color:#081014; border-color: var(--accent1); font-weight:600; box-shadow:0 2px 10px -2px #0009; }
.ed-btn.primary:hover { filter:brightness(1.1); }
.ed-btn:disabled { opacity:.35; pointer-events:none; }

.editor-frames { display:flex; flex-wrap:wrap; gap:6px; margin-bottom:10px; }
.frame-btn { background: var(--panel-lighter); border:1px solid var(--panel-border); padding:4px 10px; font-size:12px; border-radius:8px; cursor:pointer; transition:.18s; color: var(--text-dim); }
.frame-btn:hover { color: var(--text); background: #242d34; }
.frame-btn.current { background: var(--accent1); color:#091014; border-color: var(--accent1); }

.editor-canvas-wrap { background: var(--panel-bg); padding:10px; border:1px solid var(--panel-border); border-radius:18px; position:relative; box-shadow:0 2px 10px -4px rgba(0,0,0,.5) inset, 0 2px 10px -6px rgba(0,0,0,.45); min-height:260px; display:flex; flex-direction:column; }
.editor-canvas-wrap { width:100%; max-width:100%; box-sizing:border-box; overflow:hidden; }
@media (max-width:520px){
  .editor-canvas-wrap { padding:8px 8px 9px; border-radius:16px; }
  .editor-canvas-wrap::before, .editor-canvas-wrap::after { display:none; }
}
.editor-canvas-wrap canvas { image-rendering:pixelated; display:block; width:100%; height:100%; max-width:100%; max-height:100%; }
.canvas-scale-holder { position:relative; width:100%; flex:1 1 auto; min-height:220px; aspect-ratio:1/1; }
.canvas-scale-inner { position:absolute; inset:0; display:flex; justify-content:center; align-items:center; width:100%; height:100%; overflow:hidden; }

.editor-hint { font-size:11px; opacity:.68; margin-top:6px; }
.editor-drawing { display:flex; gap:10px; align-items:center; margin-top:10px; flex-wrap:wrap; }
.editor-drawing input[type=color] { background: var(--panel-bg); border:1px solid var(--panel-border); width:42px; height:34px; padding:0; border-radius:10px; cursor:pointer; }
.editor-save-row { display:flex; gap:12px; margin-top:14px; }
.editor-zoom { display:flex; align-items:center; gap:8px; margin:2px 0 10px; flex-wrap:wrap; }
.editor-zoom input[type=range] { width:160px; accent-color: var(--accent1); }
.zoom-label { font-size:11px; opacity:.65; }
.zoom-val { font-size:11px; opacity:.7; min-width:40px; text-align:right; }

.editor-side-title { margin:4px 0 6px; font-size:14px; letter-spacing:.6px; text-transform:uppercase; opacity:.78; font-weight:600; }
.editor-inventory-grid { display:grid; grid-template-columns:repeat(auto-fill,minmax(96px,1fr)); gap:6px; background: var(--panel-bg); padding:8px; border:1px solid var(--panel-border); border-radius:14px; max-height:320px; overflow:auto; box-shadow:0 2px 8px -4px rgba(0,0,0,0.4) inset; }
.editor-item { background: var(--panel-lighter); border:1px solid var(--panel-border); padding:4px 4px 6px; font-size:10px; border-radius:10px; cursor:grab; user-select:none; position:relative; line-height:1.15; display:flex; flex-direction:column; gap:2px; transition:.25s; color: var(--text-dim); }
.editor-item.attached { background: linear-gradient(135deg,#19313a,#14252c); box-shadow:0 0 0 1px var(--accent1); color: var(--text); }
.editor-item.selected { box-shadow:0 0 0 2px var(--accent2), 0 2px 10px -4px #000; color: var(--text); }
.editor-item:hover { transform:translateY(-3px); box-shadow:0 6px 16px -6px #000, 0 0 0 1px #2a333b; }

/* ==== Горизонтальная лента инвентаря внутри canvas-wrap ==== */
.inv-hstrip-wrapper { margin-top:14px; background: var(--panel-bg); padding:8px 10px 10px; border:1px solid var(--panel-border); border-radius:16px; box-shadow:0 2px 8px -4px #0008 inset; }
.inv-hstrip-wrapper .editor-side-title.compact { margin:0 0 4px; text-transform:none; letter-spacing:.4px; font-size:13px; }
.inv-hstrip { display:flex; flex-wrap:nowrap; gap:8px; overflow-x:auto; overflow-y:hidden; padding:4px 2px 6px; -webkit-overflow-scrolling:touch; scrollbar-width:thin; }
.inv-hstrip { touch-action: pan-x; } /* разрешаем только горизонтальный свайп, блокируем вертикальный старт (чтобы не проскроллить страницу при перетягивании вверх) */
.editor-item.inv-mini { touch-action: none; } /* сам элемент не инициирует жест прокрутки */
.inv-hstrip::-webkit-scrollbar { height:8px; }
.inv-hstrip::-webkit-scrollbar-track { background:#1a2128; border-radius:4px; }
.inv-hstrip::-webkit-scrollbar-thumb { background:#2a333b; border-radius:4px; }
.inv-hstrip::-webkit-scrollbar-thumb:hover { background:#34414c; }
.editor-item.inv-mini { flex:0 0 auto; width:110px; min-height:54px; padding:6px 6px 6px; font-size:11px; line-height:1.15; }
.editor-item.inv-mini.attached { background: linear-gradient(135deg,#1d3a42,#152a30); }
.editor-item.inv-mini .mini-row { display:flex; align-items:center; gap:4px; }
.editor-item.inv-mini .rarity-dot { width:10px; height:10px; border-radius:50%; flex:0 0 auto; box-shadow:0 0 0 1px #000; }
.editor-item.inv-mini .mini-name { flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; font-weight:600; }
.editor-item.inv-mini .mini-bonus { font-size:10px; opacity:.7; }
@media (max-width:700px){
  .editor-item.inv-mini { width:96px; }
  .inv-hstrip-wrapper { padding:6px 8px 8px; }
}

.editor-mini-hint { font-size:11px; margin-top:10px; opacity:.65; }
.editor-joints { display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; }
.joint-btn { width:56px; height:36px; font-size:11px; border-radius:14px; border:1px solid var(--panel-border); background: var(--panel-lighter); color: var(--text-dim); cursor:pointer; transition:.25s; font-weight:500; position:relative; }
.joint-btn.sel { color:var(--text); }
.joint-btn.attached { background: linear-gradient(155deg,#2b4b5c,#20333d); color:#fff; border-color: var(--accent1); box-shadow:0 0 0 1px var(--accent1) inset, 0 2px 8px -4px #000; }
.joint-btn.hovered { box-shadow:0 0 0 2px var(--accent2), 0 2px 6px -2px #000; color: var(--text); }
.joint-btn:disabled { opacity:.3; cursor:not-allowed; }

.editor-attachments { margin-top:16px; background: var(--panel-bg); padding:10px 12px 12px; border:1px solid var(--panel-border); border-radius:18px; font-size:12px; line-height:1.25; }
.ea-title { font-weight:600; margin-bottom:6px; font-size:11px; letter-spacing:.6px; text-transform:uppercase; opacity:.78; }
.ea-row { padding:3px 6px; border-radius:10px; background: var(--panel-lighter); margin-top:4px; font-size:11px; }
.editor-tip { margin-top:16px; font-size:11px; opacity:.58; line-height:1.35; }
.editor-workspace { display:grid; grid-template-columns:minmax(260px, 420px) minmax(260px, 1fr); gap:22px; align-items:start; width:100%; }
.editor-canvas-col { display:flex; flex-direction:column; }
.editor-inv-col { display:flex; flex-direction:column; max-height:calc(100dvh - 260px); overflow:hidden; }
/* Скролл только внутри сетки предметов */
.editor-inv-col .editor-inventory-grid { flex:1; overflow:auto; max-height:100%; }
/* Микро-скролл стиль */
.editor-inv-col .editor-inventory-grid::-webkit-scrollbar { width:8px; }
.editor-inv-col .editor-inventory-grid::-webkit-scrollbar-track { background:#1b2228; border-radius:6px; }
.editor-inv-col .editor-inventory-grid::-webkit-scrollbar-thumb { background:#2a333b; border-radius:6px; }
.editor-inv-col .editor-inventory-grid::-webkit-scrollbar-thumb:hover { background:#32404a; }

@media (max-width: 980px) {
  .editor-workspace { grid-template-columns: minmax(250px, 1fr) 320px; }
}
@media (max-width: 820px) {
  .editor-workspace { grid-template-columns: 1fr; }
  .editor-inv-col { order:2; max-height:none; }
  .editor-inv-col .editor-inventory-grid { max-height:none; overflow:visible; }
  .editor-canvas-col { order:1; }
}

@media (max-width: 900px) {
  .editor-root { padding:16px 14px 38px; }
  .main-stage { margin-top:6px; margin-bottom:6px; }
  .editor-left { order:1; }
  .editor-inventory-grid { grid-template-columns:repeat(auto-fill,minmax(110px,1fr)); }
  .editor-canvas-wrap { margin:auto; }
}

@media (max-width: 560px) {
  .editor-root { gap:14px; padding:14px 12px 34px; }
  .editor-joints { gap:6px; }
  .joint-btn { width:48px; height:34px; font-size:10px; }
  .editor-inventory-grid { grid-template-columns:repeat(auto-fill,minmax(100px,1fr)); }
  .editor-item { font-size:10px; }
  .editor-toolbar { gap:8px; }
  .ed-btn { padding:5px 9px; font-size:12px; }
}

@media (max-width: 400px) {
  .editor-root { padding:12px 10px 30px; }
  .editor-inventory-grid { grid-template-columns:repeat(auto-fill,minmax(92px,1fr)); }
  .joint-btn { width:44px; height:32px; }
  .ed-btn { padding:5px 8px; }
}

/* ======= Modal generic ======= */
.modal-backdrop { position:fixed; inset:0; background:rgba(10,14,18,.66); backdrop-filter: blur(8px) saturate(1.25); display:flex; align-items:center; justify-content:center; z-index:500; padding:30px 16px; animation: fadeIn .25s; }
.modal { background:linear-gradient(140deg,#212a31 0%, #181f25 120%); border:1px solid #2c363f; border-radius:20px; padding:24px 24px 26px; width:100%; max-width:380px; box-shadow:0 10px 42px -10px #000e, 0 4px 18px -6px #000a, inset 0 0 0 1px #1d252b; color:#e2ebf2; font-size:14px; position:relative; animation: popIn .5s ease; }
.modal h3 { font-size:19px; font-weight:600; letter-spacing:.6px; margin:0 0 16px; color:#f0f7fa; text-shadow:0 2px 6px #000a; }
.modal button { font-size:13px; font-weight:600; letter-spacing:.5px; padding:10px 18px 10px; background:#273038; border:1px solid #36424b; color:#d7e3ea; border-radius:14px; cursor:pointer; box-shadow:0 2px 8px -2px #000a, inset 0 0 0 1px #1d252b; transition: background .2s, transform .18s, color .2s; }
.modal button:hover { background:#313c45; }
.modal button:active { background:var(--grad-accent); color:#081014; transform:translateY(2px); box-shadow:0 1px 4px -1px #000c, 0 0 0 1px #46f2c244 inset; }
.modal button[disabled] { opacity:.55; cursor:default; }
.modal button[disabled]:active { transform:none; }
